<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Объекты недвижимости</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h2>Объекты недвижимости</h2>
    <button id="createObjectBtn">Добавить объект</button>
    <div id="objectsList"></div>

    <!-- Модальное окно для добавления нового объекта -->
    <div id="createObjectModal" class="modal">
        <div class="modal-content">
            <h3>Создание нового объекта</h3>
            <label for="objectName">Название объекта:</label>
            <input type="text" id="objectName" placeholder="Введите название объекта">
            <label for="objectType">Тип объекта:</label>
            <select id="objectType">
                <option value="BUILDING">Здание</option>
                <option value="FLOOR">Этаж</option>
                <option value="APARTMENT">Квартира</option>
            </select>
            <button onclick="createObject()">Создать объект</button>
            <button onclick="closeCreateObjectModal()">Закрыть</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadObjects();
        document.getElementById("createObjectBtn").addEventListener("click", openCreateObjectModal);
    });

    function loadObjects() {
        fetch("http://localhost:8080/real-estate-objects", {
            method: "GET",
            headers: { "Authorization": `Bearer ${getCookie("jwt")}` }
        })
            .then(response => response.json())
            .then(objects => {
                const objectsList = document.getElementById("objectsList");
                objectsList.innerHTML = ""; // Очистка списка перед добавлением новых элементов
                objects.forEach(object => {
                    const objectItem = document.createElement("div");
                    objectItem.innerHTML = `
                    <p><strong>${object.name}</strong> (${object.type})</p>
                    <button onclick="editObject(${object.id})">Редактировать</button>
                    <button onclick="deleteObject(${object.id})">Удалить</button>
                `;
                    objectsList.appendChild(objectItem);
                });
            })
            .catch(error => {
                console.error("Ошибка загрузки объектов:", error);
            });
    }

    function openCreateObjectModal() {
        document.getElementById("createObjectModal").style.display = "block";
    }

    function closeCreateObjectModal() {
        document.getElementById("createObjectModal").style.display = "none";
    }

    function createObject() {
        const name = document.getElementById("objectName").value;
        const type = document.getElementById("objectType").value;

        const object = { name, type };

        fetch("http://localhost:8080/real-estate-objects", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${getCookie("jwt")}`
            },
            body: JSON.stringify(object)
        })
            .then(response => response.json())
            .then(newObject => {
                console.log("Объект создан:", newObject);
                loadObjects(); // Перезагружаем список объектов
                closeCreateObjectModal();
            })
            .catch(error => {
                console.error("Ошибка при создании объекта:", error);
            });
    }

    function editObject(id) {
        // Добавить логику редактирования объекта
        alert(`Редактирование объекта с ID: ${id}`);
    }

    function deleteObject(id) {
        fetch(`http://localhost:8080/real-estate-objects/${id}`, {
            method: "DELETE",
            headers: {
                "Authorization": `Bearer ${getCookie("jwt")}`
            }
        })
            .then(() => {
                console.log("Объект удален");
                loadObjects(); // Перезагружаем список объектов
            })
            .catch(error => {
                console.error("Ошибка при удалении объекта:", error);
            });
    }

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
    }
</script>

</body>
</html>
